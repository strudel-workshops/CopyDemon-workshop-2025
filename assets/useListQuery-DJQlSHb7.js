import{R as m,j as u,P as x,S as p,B as h,v as S,x as y,z as g,G as j,H as A,J as F}from"./index-fPyZG6U4.js";import{C as w}from"./Close-DyFPnqLI.js";import{u as B,h as E}from"./FilterField-C_KYt1qq.js";import{C as P}from"./DataGrid-DZ9NVR2A.js";import{u as b}from"./useQuery-DNcqBgWZ.js";const z=({header:e="Filters",grouped:s=!0,onChange:a,onClose:o,config:d,children:l,...c})=>{const{activeFilters:t,dispatch:r}=B();let i=0;m.Children.forEach(l,f=>{if(m.isValidElement(f)&&f.props.field&&E(t.find(v=>v.field===f.props.field)))return i++});const n=()=>{r({type:"SET_ACTIVE_FILTERS",payload:[]})};return u.jsx(x,{elevation:0,variant:"outlined",...c,children:u.jsxs(p,{spacing:0,children:[e&&u.jsxs(p,{direction:"row",spacing:0,alignItems:"center",sx:{borderBottom:"1px solid",borderBottomColor:"grey.300",paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},children:[u.jsxs(p,{direction:"row",spacing:2,flex:1,children:[u.jsx(h,{children:e}),i>0&&u.jsx(P,{label:`${i} active`,color:"primary",size:"small"})]}),u.jsx(S,{variant:"outlined",onClick:n,sx:{marginRight:1},children:"Reset"}),u.jsx(y,{onClick:o,children:u.jsx(w,{})})]}),s&&u.jsx(p,{spacing:0,children:l}),!s&&u.jsx(p,{spacing:2,sx:{padding:2},children:l})]})})},k=(e,s)=>s.split(".").reduce((a,o)=>a==null?void 0:a[o],e),R=(e,s)=>{let a=e;return s&&(a=e.filter(o=>JSON.stringify(o).toLowerCase().indexOf(s.toLowerCase())>-1)),a},q=(e,s,a)=>{let o=e;if(e&&s.length>0){const d={};s.forEach(l=>{if(a){const c=a.find(t=>t.field===l.field);d[l.field]=c==null?void 0:c.operator}}),o=e.filter(l=>{let c=!0;return s.forEach(t=>{let r=!1;if(c===!0){const i=k(l,t.field);switch(d[t.field]){case"contains":{i&&typeof i=="string"&&typeof t.value=="string"&&i.toLowerCase().indexOf(t.value.toLowerCase())>-1&&(r=!0);break}case"contains-one-of":{Array.isArray(t.value)&&t.value.forEach(n=>{r||(Array.isArray(i)?i.indexOf(n)>-1&&(r=!0):i===n&&(r=!0))});break}case"equals-one-of":{Array.isArray(t.value)&&t.value.forEach(n=>{r||i===n&&(r=!0)});break}case"between-inclusive":{if(Array.isArray(t.value)){const n=t.value[0],f=t.value[1];i>=n&&i<=f&&(r=!0)}break}case"between-dates-inclusive":{if(typeof i=="string"&&Array.isArray(t.value)&&t.value[0]&&t.value[1]){const n=g(i);n.isAfter(t.value[0])&&n.isBefore(t.value[1])&&(r=!0)}else r=!0;break}}}r||(c=!1)}),c})}return o},I=(e,s,a,o)=>{const d=R(e,o);return q(d,s,a)},M=e=>{let s=e.queryMode==="server"?j(e.activeFilters,e.filterConfigs):new URLSearchParams;e.staticParams&&Object.keys(e.staticParams).forEach(r=>{e.staticParams&&s.append(r,e.staticParams[r].toString())}),e.queryMode==="server"&&(s.append("limit",e.pageSize.toString()),s.append("offset",e.offset.toString()));const a=e.queryMode==="server"?[e.dataSource,{...e.activeFilters,pageSize:e.pageSize,offset:e.offset}]:[e.dataSource],{isPending:o,isFetching:d,isError:l,data:c,error:t}=b({queryKey:a,queryFn:async()=>{const r=s.toString();let i=e.dataSource;return r&&r.length>0&&(i=`${e.dataSource}?${r}`),await F(i)},placeholderData:A});return{isPending:o,isFetching:d,isError:l,data:c,error:t}};export{z as F,I as f,M as u};
